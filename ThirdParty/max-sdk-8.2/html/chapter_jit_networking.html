<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Max API: Jitter Networking Specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Max API
   &#160;<span id="projectnumber">8.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('chapter_jit_networking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Jitter Networking Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This appendix describes the format of the data sent by a jit.net.send object.</p>
<p>The object attempts to form a TCP connection with a host at the IP and port specified by the object's attributes. Any program wishing to receive data will therefore have to set itself up as a host and listen for incoming TCP connections.</p>
<p>Once a connection is formed, data can be sent. Data is sent as a stream of chunks. The first thing received will be a chunk header. It consists of a 32-bit chunk ID and a 32-bit int representing the size of the next chunk to come. The chunk ID can be one of the following 4-char symbols, depending on what kind of packet it is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define JIT_MATRIX_PACKET_ID  &#39;JMTX&#39;</span></div>
<div class="line"><span class="preprocessor">#define JIT_MATRIX_LATENCY_PACKET_ID  &#39;JMLP&#39;</span></div>
<div class="line"><span class="preprocessor">#define JIT_MESSAGE_PACKET_ID  &#39;JMMP&#39;</span></div>
</div><!-- fragment --><p>This chunk header could be represented in C by the following struct: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_net_packet_header</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> id;</div>
<div class="line">   <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> size; <span class="comment">//size of packet to come</span></div>
<div class="line">} t_jit_net_packet_header;</div>
<div class="ttc" id="agroup__misc_html_ga7a70fc116b0ee9021b19d329ae2b47a0"><div class="ttname"><a href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a></div><div class="ttdeci">int32_t t_int32</div><div class="ttdoc">a 4-byte int</div><div class="ttdef"><b>Definition:</b> max_types.h:13</div></div>
</div><!-- fragment --><p>If the chunk is a matrix packet, the next data received will be a header of 288 bytes with the following contents:</p>
<table class="doxtable">
<tr>
<td>id </td><td>'JMTX'  </td></tr>
<tr>
<td>Size </td><td>288 (32-bit int, size of this header)  </td></tr>
<tr>
<td>Planecount </td><td>32-bit int  </td></tr>
<tr>
<td>Type </td><td>32-bit int, 0 for char, 1 for long, 2 for float32, 3 for float64  </td></tr>
<tr>
<td>Dimcount </td><td>32-bit int  </td></tr>
<tr>
<td>Dim </td><td>Array of 32 32-bit ints  </td></tr>
<tr>
<td>Dimstride </td><td>Array of 32 32-bit ints  </td></tr>
<tr>
<td>Datasize </td><td>32-bit int, size of the data buffer to come  </td></tr>
<tr>
<td>Time </td><td>64-bit double precision float  </td></tr>
</table>
<p>This chunk could be represented with the following C struct:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_net_packet_matrix</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> id;</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> size;</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> planecount;</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> type;           <span class="comment">//0=char,1=long,2=float32,3=float64</span></div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> dimcount;</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> dim[<a class="code" href="group__jitter.html#gaf715e26dfffd1f8de1c18449e2770cffa21a309e1b0975422a7a970b5e77c3582">JIT_MATRIX_MAX_DIMCOUNT</a>];</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> dimstride[<a class="code" href="group__jitter.html#gaf715e26dfffd1f8de1c18449e2770cffa21a309e1b0975422a7a970b5e77c3582">JIT_MATRIX_MAX_DIMCOUNT</a>];</div>
<div class="line">    <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> datasize;</div>
<div class="line">    <span class="keywordtype">double</span>  time;</div>
<div class="line">} t_jit_net_packet_matrix;</div>
<div class="ttc" id="agroup__jitter_html_gaf715e26dfffd1f8de1c18449e2770cffa21a309e1b0975422a7a970b5e77c3582"><div class="ttname"><a href="group__jitter.html#gaf715e26dfffd1f8de1c18449e2770cffa21a309e1b0975422a7a970b5e77c3582">JIT_MATRIX_MAX_DIMCOUNT</a></div><div class="ttdeci">@ JIT_MATRIX_MAX_DIMCOUNT</div><div class="ttdoc">maximum dimension count</div><div class="ttdef"><b>Definition:</b> jit.common.h:64</div></div>
</div><!-- fragment --><p>Following this header the next data received will be the matrix data, the size of which was passed in the above header. When using the data, please note the dimstrides transmitted in the header.</p>
<p>The time field in the above header will be set to the time of transmission from the sending computer. jit.net.send expects the server to respond by sending back timing data of its own â€“ it uses this data to estimate the transmission latency. The exact data in the latency chunk that jit.net.send expects to receive is the following:</p>
<table class="doxtable">
<tr>
<td>id </td><td>'JMLP'  </td></tr>
<tr>
<td>client_time_original </td><td>64-bit double, the time value received in the matrix header packet  </td></tr>
<tr>
<td>server_time_before_data </td><td>64-bit double, the time on the server when the packet header is received  </td></tr>
<tr>
<td>server_time_after_data </td><td>64-bit double, the time on the server after the packet has been processed and is in use  </td></tr>
<tr>
<td></td></tr>
</table>
<p>This chunk can be represnted by the following C struct:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_net_packet_latency</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__misc.html#ga7a70fc116b0ee9021b19d329ae2b47a0">t_int32</a> id;</div>
<div class="line">   <span class="keywordtype">double</span> client_time_original;</div>
<div class="line">   <span class="keywordtype">double</span> server_time_before_data;</div>
<div class="line">   <span class="keywordtype">double</span> server_time_after_data;</div>
<div class="line">} t_jit_net_packet_latency;</div>
</div><!-- fragment --><p>The difference between the server time before and server time after processing the data represents the time it takes the server to mobilize the data after it has been received. jit.net.send will send and expects to receive time in milliseconds. When this timing information is received by the transmitting computer, it notes its current time, calculates the round trip time and then estimates the latency as half the round trip time plus half of the server processing time. This estimate is accurate if the time of flight from A to B is the same as the time of flight from B to A, but network topology can be very complicated, and often the route from A to B is not the reverse of the route from B to A. In simple situations, such as a direct connection between two computers or a small LAN, the estimate should be reasonably accurate.</p>
<p>Finally, the last type of packet that can be sent is the message packet. The size of the message packet is sent in the initial header packet. Standard <a class="el" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a81c1a8550f038db16a619167a70a79b6" title="request that args be passed as an array, the routine will check the types itself.">A_GIMME</a> messages (<a class="el" href="structt__symbol.html" title="The symbol.">t_symbol</a> *s, long ac, <a class="el" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> *av) are serialized starting with a 32-bit integer that contains the size of the serialized message in bytes. Following that another 32-bit integer gives the argument count for the atoms. Following that comes the message atoms themselves, starting with the leading symbol if it exists. Each atom is represented in memory first with a char that indicates what type of atom it is: 's' for symbol, 'l' for long, and 'f' for float. For long and float atoms, the next 4 bytes contain the value of the atom; for symbol atoms a null terminated character string follows.</p>
<p>All data is represented with little endian byte ordering.</p>
<p>Below is a C function that will deserialize a message passed in as a data pointer.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> gimme_deserialize(<span class="keywordtype">char</span> *data, <a class="code" href="structt__symbol.html">t_symbol</a> **s, <span class="keywordtype">long</span> *ac, <a class="code" href="structt__atom.html">t_atom</a> **av)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">char</span> *curr = data;</div>
<div class="line">   <span class="keywordtype">float</span> *currf;</div>
<div class="line">   <span class="keywordtype">long</span> *currl,i;</div>
<div class="line">   <span class="keywordtype">long</span> datasize = BE_I32(*((<span class="keywordtype">long</span> *)curr));</div>
<div class="line">   curr += <span class="keyword">sizeof</span>(long);</div>
<div class="line">   *ac = BE_I32(*(<span class="keywordtype">long</span> *)(curr));</div>
<div class="line">   curr += <span class="keyword">sizeof</span>(long);</div>
<div class="line">   *av = (<a class="code" href="structt__atom.html">t_atom</a> *)<a class="code" href="group__memory.html#ga24c6073f05e5c4a9bf980b7a4320fbf4">sysmem_newptr</a>(<span class="keyword">sizeof</span>(<a class="code" href="structt__atom.html">t_atom</a>)*(*ac));</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (*curr == ATOM_SERIALIZATION_SYMBOL_CODE)</div>
<div class="line">   {</div>
<div class="line">      curr++;</div>
<div class="line">      *s = <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(curr);</div>
<div class="line">      <span class="keywordflow">while</span> (*(++curr) != <span class="charliteral">&#39;\0&#39;</span>) ;</div>
<div class="line">      curr++;</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">      *s = 0L;</div>
<div class="line">   <span class="keywordflow">for</span> (i=0;i&lt;*ac;i++)</div>
<div class="line">      <span class="keywordflow">switch</span> (*curr++)</div>
<div class="line">      {</div>
<div class="line">         <span class="keywordflow">case</span> ATOM_SERIALIZATION_SYMBOL_CODE:</div>
<div class="line">            (*av)[i].a_type = <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a2d661c2a5d949566e2f1944c99bceeea">A_SYM</a>;</div>
<div class="line">            (*av)[i].a_w.w_sym = <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a>(curr);</div>
<div class="line">            <span class="keywordflow">while</span> (*(++curr) != <span class="charliteral">&#39;\0&#39;</span>) ;</div>
<div class="line">            curr++;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">         <span class="keywordflow">case</span> ATOM_SERIALIZATION_FLOAT_CODE:</div>
<div class="line">            (*av)[i].a_type = <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a0b3aa0ab8104573dfc9cb70b5b08031f">A_FLOAT</a>;</div>
<div class="line">            (*av)[i].a_w.w_float = BE_F32(*((<span class="keywordtype">float</span> *)curr));</div>
<div class="line">            curr += <span class="keyword">sizeof</span>(float);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">         <span class="keywordflow">case</span> ATOM_SERIALIZATION_LONG_CODE:</div>
<div class="line">            (*av)[i].a_type = <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a002f28879581a6f66ea492b994b96f1e">A_LONG</a>;</div>
<div class="line">            (*av)[i].a_w.w_long = BE_I32(*((<span class="keywordtype">long</span> *)curr));</div>
<div class="line">            curr += <span class="keyword">sizeof</span>(long);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__atom_html_gga8aa6700e9f00b132eb376db6e39ade47a002f28879581a6f66ea492b994b96f1e"><div class="ttname"><a href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a002f28879581a6f66ea492b994b96f1e">A_LONG</a></div><div class="ttdeci">@ A_LONG</div><div class="ttdoc">long integer</div><div class="ttdef"><b>Definition:</b> ext_mess.h:279</div></div>
<div class="ttc" id="agroup__atom_html_gga8aa6700e9f00b132eb376db6e39ade47a0b3aa0ab8104573dfc9cb70b5b08031f"><div class="ttname"><a href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a0b3aa0ab8104573dfc9cb70b5b08031f">A_FLOAT</a></div><div class="ttdeci">@ A_FLOAT</div><div class="ttdoc">32-bit float</div><div class="ttdef"><b>Definition:</b> ext_mess.h:280</div></div>
<div class="ttc" id="agroup__atom_html_gga8aa6700e9f00b132eb376db6e39ade47a2d661c2a5d949566e2f1944c99bceeea"><div class="ttname"><a href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47a2d661c2a5d949566e2f1944c99bceeea">A_SYM</a></div><div class="ttdeci">@ A_SYM</div><div class="ttdoc">t_symbol pointer</div><div class="ttdef"><b>Definition:</b> ext_mess.h:281</div></div>
<div class="ttc" id="agroup__memory_html_ga24c6073f05e5c4a9bf980b7a4320fbf4"><div class="ttname"><a href="group__memory.html#ga24c6073f05e5c4a9bf980b7a4320fbf4">sysmem_newptr</a></div><div class="ttdeci">BEGIN_USING_C_LINKAGE t_ptr sysmem_newptr(t_ptr_size size)</div><div class="ttdoc">Allocate memory.</div></div>
<div class="ttc" id="agroup__symbol_html_ga5d8db08b384aeb76eaee85a15f46fbcb"><div class="ttname"><a href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb">gensym</a></div><div class="ttdeci">t_symbol * gensym(C74_CONST char *s)</div><div class="ttdoc">Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating the symbol if...</div></div>
<div class="ttc" id="astructt__atom_html"><div class="ttname"><a href="structt__atom.html">t_atom</a></div><div class="ttdoc">An atom is a typed datum.</div><div class="ttdef"><b>Definition:</b> ext_mess.h:323</div></div>
<div class="ttc" id="astructt__symbol_html"><div class="ttname"><a href="structt__symbol.html">t_symbol</a></div><div class="ttdoc">The symbol.</div><div class="ttdef"><b>Definition:</b> ext_mess.h:102</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
